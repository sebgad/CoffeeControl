<!DOCTYPE html>
<html lang="en">
<head>
  <link rel="stylesheet" type="text/css" href="style.css">
  <title>Silvia Control</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
  <script type="text/javascript" src="https://www.google.com/jsapi"></script>
  <script type="text/javascript" src="table.js"></script>

  <script type="text/javascript">
   google.charts.load('current', {'packages':['gauge', 'corechart']});
   google.charts.setOnLoadCallback(drawChart);

  function drawChart() {
    var dataTemp = google.visualization.arrayToDataTable([
      ['Label', 'Value'],
      ['Temp', 0.0],
    ]);
      
    var optionsTemp = {
      width: 400, height: 120,
      greenFrom: 90, greenTo: 95,
      redFrom: 95, redTo: 120,
      yellowFrom:0, yellowTo: 90,
      minorTicks: 10
    };
      
    var formatterTemp = new google.visualization.NumberFormat({
      suffix: 'Â°C',
      fractionDigits: 1,
    });
    formatterTemp.format(dataTemp, 1); 
      
    var chartTemp = new google.visualization.Gauge(document.getElementById('gauge_Temp'));
    chartTemp.draw(dataTemp, optionsTemp);

    setInterval(function() {
      var xhr=new XMLHttpRequest();
      xhr.open("GET","data.csv");
      var data;
      xhr.onload= function() {
        var str_buf = xhr.responseText;
        data = str_buf.split(/\r?\n/g);

        // change status icons
        var obj_sel_heating = document.getElementById("selHeating");
        var f_last_heating_status = data[data.length-2].split(",")[2]; 
        if(f_last_heating_status == 0){
          obj_sel_heating.className = "indicator off";
        } else if (f_last_heating_status == 1) {
          obj_sel_heating.className = "indicator on";
        }

        var temp = parseFloat(data[data.length-2].split(",")[1]);
        
        dataTemp.setValue(0, 1, temp);
        formatterTemp.format(dataTemp, 1);
        chartTemp.draw(dataTemp, optionsTemp);
      }
      xhr.send();
    }, 3000);
   }
 </script> 
</head>
<body>
  <style>
    p {
      display: flex;
      justify-content: left;
      align-items: center;
    }

    p > span {
      display: inline-block;
      width: 20px;
    }

    p > span:first-child {
      display: inline-block;
      width: 200px;
    }
    </style>

<div class="header">
  <h1>Silvia Control</h1>
  A simple <b>web interface</b> to control Rancilio Silvia espresso machine.
</div>

<div class="navbar">
  <a href="/" class="active">Home</a>
  <a href="graphs">Graphs</a>
  <a href="settings">Settings</a>
  <a href="#" class="right">About</a>
</div>

<div class="main">
  <h2>Control Board</h2>
  <h3>Status</h3>
  <p>
    <span>HEATING ON</span>
    <span id="selHeating"></span>
  </p>
  <h3>Actual Sensor Values</h3>
  <div class="container">
    <div class="item", id="gauge_Temp"></div>
    <div class="item", id="gauge_Press"></div>
  </div>
</div>

<div class="footer">
  <h5>Footer</h5>
</div>

</body>
</html>
