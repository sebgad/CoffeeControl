<!DOCTYPE html>
<html lang="en">
<head>
  <link rel="stylesheet" type="text/css" href="style.css">
  <title>Silvia Control</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <!-- Java script for graphs.html -->
  <script type="text/javascript">

  function onSubmitParams(){
    var obj_div_elements = document.getElementById("id_input");
    var obj_div_input_children = obj_div_elements.getElementsByTagName("input");
    var obj_json_req = {};

    for (i = 0; i < obj_div_input_children.length; ++i) {
      obj_json_req[obj_div_input_children[i].id] = parseFloat(obj_div_input_children[i].value);
    }
    var obj_http_request = new XMLHttpRequest();
    obj_http_request.open("POST", "/paramUpdate", true);
    obj_http_request.setRequestHeader("Content-Type", "application/json");
    obj_http_request.onload= function() {
        // assign response text from request to variable
        var str_buf = obj_http_request.responseText;
        alert(str_buf);
    }
    obj_http_request.send(JSON.stringify(obj_json_req));
  }

  function onResetParameter(){
    // initialize http request object for asynchronous file request
    var obj_http_request=new XMLHttpRequest();
    // request data.csv from http server
    obj_http_request.open("GET","/paramReset");
      
    // define function which is executed when requested is fully loaded
    obj_http_request.onload= function() {
      var str_buf = obj_http_request.responseText;
      alert(str_buf);
    }

    obj_http_request.send();
    onGetParameter();
  }

  function onGetParameter(){
    // initialize http request object for asynchronous file request
    var obj_http_request=new XMLHttpRequest();
    // request data.csv from http server
    obj_http_request.open("GET","params.json");
      
    // define function which is executed when requested is fully loaded
    obj_http_request.onload= function() {
      // get response as string from esp async webserver
      var str_buf = obj_http_request.responseText;
      // parse string response to json object
      const obj_json_req = JSON.parse(str_buf);
      
      // get form object in html side
      var obj_form = document.getElementById("id_input");
      
      // iterate over json object and create text inputs
      for(var str_key in obj_json_req){
        var obj_input = document.getElementById(str_key);

        if (!obj_input){
          // define label for text input and line break
          var obj_label = document.createElement("Label");
          var obj_br_label = document.createElement("BR");
          obj_label.setAttribute("for", str_key);
          obj_label.innerHTML = str_key;
          
          // append label and line break form
          obj_form.appendChild(obj_label);
          obj_form.appendChild(obj_br_label);
          
          // define text input and line break
          var obj_input = document.createElement("Input");
          var obj_br_input = document.createElement("BR");
          obj_input.type="text";
          obj_input.value=obj_json_req[str_key];
          obj_input.id=str_key;
          
          // append input to form
          obj_form.appendChild(obj_input);
          obj_form.appendChild(obj_br_input);
        } else {
          obj_input.value=obj_json_req[str_key];
        }
      }

    }
    obj_http_request.send();
  }
  </script>
</head>
<body onload="onGetParameter()">
  <style>
      input[type=text] {
        width: 50%;
        padding: 12px 20px;
        margin: 8px 0;
        box-sizing: border-box;
        border: 3px solid #ccc;
        -webkit-transition: 0.5s;
        transition: 0.5s;
        outline: none;
      }

    input[type=text]:focus {
        border: 3px solid #555;
    }

    input[type=button], input[type=submit], input[type=reset] {
        background-color: #4CAF50;
        border: none;
        color: white;
        padding: 16px 32px;
        text-decoration: none;
        margin: 4px 2px;  
        cursor: pointer;
        border-radius: 4px;
        font-size:medium;
    }

  </style>
<div class="header">
  <h1>Silvia Control</h1>
  A simple <b>web interface</b> to control Rancilio Silvia espresso machine.
</div>

<div class="navbar">
  <a href="/">Home</a>
  <a href="graphs">Graphs</a>
  <a href="settings" class="active">Settings</a>
  <a href="#" class="right">About</a>
</div>

<div class="main">
  </p>
    <h3>Parameter setup</h3>
    <form>
      <div id="id_input"></div>
      <input type="button" onclick="onSubmitParams()" value="Submit">
      <input type="button" onclick="onResetParameter()" value="Reset">
    </form>
</div>

<div class="footer">
  <h5>Footer</h5>
</div>

</body>
</html>
